from os.path import exists
import argparse
import pefile

# Argument Parsing Logic
parser = argparse.ArgumentParser(description='Static analysis on file.')
parser.add_argument('-f', dest='files', type=str, nargs='+',
                    help='File for analysis (example: ircbot.exe)')
args = parser.parse_args()

# Check supplied file exists
file_names = []
for file in args.files:
    if exists(file):
        file_names.append(file)
    else:
        print("Error: {} does not exist".format(file))
        
# Check PE Sections
pe = pefile.PE(file_names[0])
sections = []
for section in pe.sections:
    sections.append([section.Name.decode('utf-8'), hex(section.VirtualAddress), hex(section.Misc_VirtualSize), section.SizeOfRawData] )
    
# Create DataFrame
malware_table = pd.DataFrame(columns=["section_name", "virtual_address", "misc_virtual_size", "size_of_raw_data"], data=sections)
print(malware_table)
